(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[193],{1627:function(e,t,n){Promise.resolve().then(n.bind(n,8871))},8871:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var r=n(1352),i=n(6883);function o(){let{notifications:e,markAllRead:t}=(0,i.useClientSession)();return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold tracking-tight",children:"Notifications"}),(0,r.jsx)("button",{onClick:t,className:"text-sm underline hover:no-underline",children:"Mark all read"})]}),0===e.length?(0,r.jsx)("p",{className:"text-muted-foreground",children:"No notifications yet."}):(0,r.jsx)("ul",{className:"space-y-2",children:e.map(e=>(0,r.jsxs)("li",{className:"border rounded p-3 ".concat(e.read?"opacity-70":""),children:[(0,r.jsx)("div",{className:"font-medium",children:e.title}),e.body&&(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:e.body}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.ts).toLocaleString()})]},e.id))})]})}},6883:function(e,t,n){"use strict";n.r(t),n.d(t,{ClientSessionProvider:function(){return l},useClientSession:function(){return d}});var r=n(1352),i=n(8348),o=n(3317),c=n(3910),s=n(9634),a=n(3916);let u=(0,i.createContext)({connected:!1,handoffInFlight:!1,notifications:[],unreadCount:0,markAllRead:()=>{}});function l(e){let{children:t}=e,{isSignedIn:n,getToken:l,sessionId:d}=(0,o.y)(),{user:f}=(0,c.aF)(),[h,m]=(0,i.useState)(),[v,p]=(0,i.useState)(!1),x=(0,i.useRef)(null);(0,i.useEffect)(()=>{!async function(){if(!n||!f){m(void 0),x.current=null;return}if(!d||x.current!==d){p(!0);try{var e,t,r;let n=await l(),i=a.env.NEXT_PUBLIC_API_BASE||"http://localhost:4000/api",o=f.username||(null===(t=f.primaryEmailAddress)||void 0===t?void 0:null===(e=t.emailAddress)||void 0===e?void 0:e.split("@")[0])||"user_".concat(f.id.slice(-6)),c=(null===(r=f.primaryEmailAddress)||void 0===r?void 0:r.emailAddress)||"".concat(f.id,"@placeholder.dev"),s=f.fullName||void 0,u=await fetch("".concat(i,"/users/me"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:n?"Bearer ".concat(n):""},body:JSON.stringify({username:o,email:c,displayName:s,age:18})});if(!u.ok)throw Error("handoff failed");let h=await u.json();h.internalJwt&&(m(h.internalJwt),x.current=d||null)}catch(e){console.warn("[handoff] failed",e)}finally{p(!1)}}}()},[n,f,d,l]);let{connected:N}=function(e){let[t,n]=(0,i.useState)(!1),r=(0,i.useRef)(e);return(0,i.useEffect)(()=>{r.current=e},[e]),(0,i.useEffect)(()=>{if(!r.current)return;let e=(0,s.zp)(r.current),t=()=>n(!0),i=()=>n(!1);return e.on("connect",t),e.on("disconnect",i),()=>{e.off("connect",t),e.off("disconnect",i)}},[r.current]),{connected:t}}(h),[w,_]=(0,i.useState)([]);(0,i.useEffect)(()=>{let e=(0,s.hb)();if(!e)return;let t=e=>_(t=>[{...e,read:!1},...t].slice(0,100));return e.on("notification:new",t),()=>{e.off("notification:new",t)}},[N]);let C=(0,i.useMemo)(()=>w.filter(e=>!e.read).length,[w]),y=()=>_(e=>e.map(e=>({...e,read:!0}))),E=(0,i.useMemo)(()=>({internalJwt:h,connected:N,handoffInFlight:v,notifications:w,unreadCount:C,markAllRead:y}),[h,N,v,w,C]);return window.__internalJwt=h,(0,r.jsx)(u.Provider,{value:E,children:t})}function d(){return(0,i.useContext)(u)}},9634:function(e,t,n){"use strict";n.d(t,{GO:function(){return l},hb:function(){return a},jl:function(){return u},zp:function(){return s}});var r=n(6006),i=n(3916);let o=null,c=null;function s(e){return o&&o.connected?o:o=(0,r.io)(i.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:4000",{transports:["websocket"],autoConnect:!0,auth:{token:e}})}function a(){return o}function u(e){if(c&&c.connected)return c;let t=i.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:4000";return c=(0,r.io)("".concat(t,"/chat"),{transports:["websocket"],autoConnect:!0,auth:{token:e}})}function l(){return c}}},function(e){e.O(0,[317,6,98,123,744],function(){return e(e.s=1627)}),_N_E=e.O()}]);