(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{9790:function(e,n,t){Promise.resolve().then(t.bind(t,9968))},9968:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return l}});var r=t(1352),o=t(8348),i=t(3317),s=t(3160),a=t(9634),c=t(3916);function l(e){let{params:n}=e,t=c.env.NEXT_PUBLIC_API_BASE||"http://localhost:4000/api",[l,d]=(0,o.useState)(null),[u,f]=(0,o.useState)(""),[h,m]=(0,o.useState)([]),[v,x]=(0,o.useState)(""),[g,p]=(0,o.useState)({}),b=(0,o.useRef)(null),{getToken:j,isSignedIn:y}=(0,i.y)();async function w(){let e=await j();await fetch("".concat(t,"/communities/").concat(n.id,"/join"),{method:"POST",headers:{Authorization:e?"Bearer ".concat(e):""}})}async function N(){let e=await j();await fetch("".concat(t,"/communities/").concat(n.id,"/leave"),{method:"POST",headers:{Authorization:e?"Bearer ".concat(e):""}})}async function _(){if(v.trim()){try{let e=window.__internalJwt,n=e?(0,a.jl)(e):(0,a.GO)();n&&n.emit("message:new",{channelId:u,content:v})}catch(e){}x("")}}return((0,o.useEffect)(()=>{fetch("".concat(t,"/communities/").concat(n.id)).then(e=>e.json()).then(e=>{var n;d(e),f(e.channels&&(null===(n=e.channels[0])||void 0===n?void 0:n.channelId)||"general")})},[n.id]),(0,o.useEffect)(()=>{if(!u)return;fetch("".concat(t,"/communities/").concat(n.id,"/channels/").concat(u,"/messages")).then(e=>e.json()).then(e=>m(e.items||[]));let e=window.__internalJwt,r=e?(0,a.jl)(e):(0,a.GO)();if(!r)return;r.emit("channel:join",u);let o=e=>{e&&e.content&&m(n=>[...n,e])},i=e=>{(null==e?void 0:e.userId)&&p(n=>({...n,[e.userId]:Date.now()}))},s=e=>{(null==e?void 0:e.userId)&&p(n=>{let{[e.userId]:t,...r}=n;return r})};return r.on("message:new",o),r.on("typing",i),r.on("stop_typing",s),()=>{r.off("message:new",o),r.off("typing",i),r.off("stop_typing",s)}},[u,n.id]),l)?((0,o.useMemo)(()=>{var e,n;return(null===(n=l.channels)||void 0===n?void 0:null===(e=n[0])||void 0===e?void 0:e.channelId)||"general"},[l]),(0,r.jsxs)("div",{className:"grid gap-4",style:{gridTemplateColumns:"240px 1fr"},children:[(0,r.jsxs)("aside",{className:"border rounded p-2 h-[70vh] overflow-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:l.name}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:[l.membersCount," members"]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(s.z,{variant:"outline",onClick:w,disabled:!y,children:"Join"}),(0,r.jsx)(s.z,{variant:"outline",onClick:N,disabled:!y,children:"Leave"})]})]}),(0,r.jsx)("div",{className:"text-xs uppercase tracking-wider text-muted-foreground mb-2",children:"Channels"}),(0,r.jsx)("ul",{className:"space-y-1",children:(l.channels||[]).map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)("button",{className:"w-full text-left px-2 py-1 rounded ".concat(u===e.channelId?"bg-accent":"hover:bg-accent/60"),onClick:()=>f(e.channelId),children:["#",e.name]})},e.channelId))})]}),(0,r.jsxs)("section",{className:"border rounded flex flex-col h-[70vh]",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-auto p-3 space-y-2",children:[h.map(e=>(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:e.senderId.slice(-6)}),": ",e.content]},e.id)),Object.keys(g).length>0&&(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"Someone is typing…"})]}),(0,r.jsxs)("div",{className:"border-t p-2 flex gap-2",children:[(0,r.jsx)("input",{className:"flex-1 border rounded px-2 py-1 bg-background",value:v,onChange:e=>(function(e){x(e);let n=window.__internalJwt,t=n?(0,a.jl)(n):(0,a.GO)();t&&(t.emit("typing",{channelId:u}),b.current&&clearTimeout(b.current),b.current=setTimeout(()=>{t.emit("stop_typing",{channelId:u})},1500))})(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),_())},placeholder:"Message #general"}),(0,r.jsx)(s.z,{onClick:_,disabled:!y,children:"Send"})]})]})]})):(0,r.jsx)("div",{children:"Loading…"})}},3160:function(e,n,t){"use strict";t.d(n,{z:function(){return d}});var r=t(1352),o=t(8348),i=t(3326),s=t(6699),a=t(6735),c=t(2792);let l=(0,s.j)("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-primary text-primary-foreground hover:opacity-90",secondary:"bg-secondary text-secondary-foreground hover:opacity-90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",destructive:"bg-destructive text-destructive-foreground hover:opacity-90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=o.forwardRef((e,n)=>{let{className:t,variant:o,size:s,asChild:d=!1,...u}=e,f=d?i.g7:"button";return(0,r.jsx)(f,{className:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return(0,c.m6)((0,a.W)(n))}(l({variant:o,size:s,className:t})),ref:n,...u})});d.displayName="Button"},9634:function(e,n,t){"use strict";t.d(n,{GO:function(){return d},hb:function(){return c},jl:function(){return l},zp:function(){return a}});var r=t(6006),o=t(3916);let i=null,s=null;function a(e){return i&&i.connected?i:i=(0,r.io)(o.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:4000",{transports:["websocket"],autoConnect:!0,auth:{token:e}})}function c(){return i}function l(e){if(s&&s.connected)return s;let n=o.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:4000";return s=(0,r.io)("".concat(n,"/chat"),{transports:["websocket"],autoConnect:!0,auth:{token:e}})}function d(){return s}}},function(e){e.O(0,[317,6,68,98,123,744],function(){return e(e.s=9790)}),_N_E=e.O()}]);